<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Ring-logger : Log ring requests &amp; responses using your favorite logging backend">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Ring-logger</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/nberger/ring-logger">View on GitHub</a>

          <h1 id="project_title">Ring-logger</h1>
          <h2 id="project_tagline">Log ring requests &amp; responses using your favorite logging backend</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/nberger/ring-logger/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/nberger/ring-logger/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="ring-logger-" class="anchor" href="#ring-logger-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ring-logger <a href="https://circleci.com/gh/nberger/ring-logger"><img src="https://circleci.com/gh/nberger/ring-logger.svg?style=svg" alt="Circle CI"></a>
</h1>

<p>Ring middleware to log duration and details for every request and response.</p>

<p>The logging backend is pluggable. Only the <a href="https://github.com/clojure/tools.logging">clojure/tools.logging</a> implementation is included.</p>

<p>Additional known backends:</p>

<ul>
<li><a href="https://github.com/nberger/ring-logger-onelog">ring-logger-onelog</a></li>
<li><a href="https://github.com/nberger/ring-logger-timbre">ring-logger-timbre</a></li>
</ul>

<p><a href="http://clojars.org/ring-logger"><img src="http://clojars.org/ring-logger/latest-version.svg" alt="Clojars Project"></a></p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>In your <code>project.clj</code>, add the following dependency:</p>

<div class="highlight highlight-clojure"><pre>    [ring-logger <span class="pl-s"><span class="pl-pds">"</span>0.7.0<span class="pl-pds">"</span></span>]</pre></div>

<p>Then, just add the middleware to your stack. It comes preconfigured with
reasonable defaults, which append ANSI colorized log messages on each
request to whatever logger is in use by <a href="https://github.com/clojure/tools.logging">clojure/tools.logging</a>.</p>

<div class="highlight highlight-clojure"><pre>    (<span class="pl-k">ns</span> <span class="pl-e">foo</span>
      (<span class="pl-c1">:require</span> [ring.adapter.jetty     <span class="pl-c1">:as</span> jetty]
                [ring.logger <span class="pl-c1">:as</span> logger]))

    (<span class="pl-k">defn</span> <span class="pl-e">my-ring-app</span> [request]
         {<span class="pl-c1">:status</span> <span class="pl-c1">200</span>
          <span class="pl-c1">:headers</span> {<span class="pl-s"><span class="pl-pds">"</span>Content-Type<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>}
          <span class="pl-c1">:body</span> <span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>})

    (<span class="pl-en">jetty/run-jetty</span> (<span class="pl-en">logger/wrap-with-logger</span> my-ring-app) {<span class="pl-c1">:port</span> <span class="pl-c1">8080</span>})</pre></div>

<h3>
<a id="usage-with-timbre" class="anchor" href="#usage-with-timbre" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage with timbre</h3>

<p>Check out <a href="https://github.com/nberger/ring-logger-timbre">ring-logger-timbre</a></p>

<h3>
<a id="migration-from-ringmiddlewarelogger-or-if-you-just-want-to-use-some-onelog-goodies" class="anchor" href="#migration-from-ringmiddlewarelogger-or-if-you-just-want-to-use-some-onelog-goodies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Migration from ring.middleware.logger (or if you just want to use some OneLog goodies)</h3>

<p>Check out <a href="https://github.com/nberger/ring-logger-onelog">ring-logger-onelog</a>, or the
<a href="https://github.com/nberger/ring-logger/tree/0.6.x">0.6.x branch</a></p>

<h2>
<a id="custom-logger-backend" class="anchor" href="#custom-logger-backend" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Logger Backend</h2>

<p>You can supply a custom logger backend by passing an instance that reifies
the ring.logger/Logger protocol as :logger.</p>

<p>Example:</p>

<div class="highlight highlight-clojure"><pre>(<span class="pl-en">wrap-with-logger</span> my-ring-app
  {<span class="pl-c1">:logger</span> (<span class="pl-en">reify</span> ring.logger/Logger
                  (<span class="pl-en">log</span> [level <span class="pl-k">throwable</span> msg]
                    (<span class="pl-k">case</span> level
                      <span class="pl-c1">:error</span>
                      (<span class="pl-en">println</span> <span class="pl-s"><span class="pl-pds">"</span>OH NOES! We have an error!<span class="pl-pds">"</span></span>
                               msg
                               (<span class="pl-k">when</span> <span class="pl-k">throwable</span> (<span class="pl-en">.getMessage</span> <span class="pl-k">throwable</span>)))

                      <span class="pl-c1">:trace</span>
                      <span class="pl-c1">nil</span> <span class="pl-c">; let's ignore trace messages</span>

                      <span class="pl-c">; else</span>
                      (<span class="pl-en">println</span> (<span class="pl-en">name</span> level) <span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span> msg)))})</pre></div>

<p>Of course this can also be done with a deftype/defrecord,
see <a href="https://github.com/nberger/ring-logger-onelog">ring-logger-onelog</a> and
<a href="https://github.com/nberger/ring-logger-timbre">ring-logger-timbre</a> for examples.</p>

<h2>
<a id="what-gets-logged" class="anchor" href="#what-gets-logged" aria-hidden="true"><span class="octicon octicon-link"></span></a>What Gets Logged</h2>

<p>The default setup logs:</p>

<ul>
<li>an :info-level message when a request begins;</li>
<li>an :info level message when a response is generated without any server
errors (i.e. its HTTP status is &lt; 500);</li>
<li>an :error level message when a response's HTTP status is &gt;= 500;</li>
<li>an :error level message with a stack trace when an exception is thrown during response generation.</li>
</ul>

<p>All messages are timestamped.</p>

<h2>
<a id="custom-messages-and-how-to-disable-coloring" class="anchor" href="#custom-messages-and-how-to-disable-coloring" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom messages and how to disable coloring</h2>

<p>Instead of the default messages (for request start, details, exceptions, response trace) you might want to
provide your own custom messages. That's easy by supplying implementations of the printer multimethods
like <code>starting</code>, <code>request-details</code>, <code>exception</code> and others (see <code>ring.logger.messages</code> ns for more details)
and passing a <code>:printer</code> option to <code>wrap-with-logger</code>, like so:</p>

<div class="highlight highlight-clojure"><pre>(<span class="pl-k">defmethod</span> request-details <span class="pl-c1">:my-printer</span>
  [{<span class="pl-c1">:keys</span> [logger] <span class="pl-c1">:as</span> options} req]
  (<span class="pl-en">trace</span> logger (<span class="pl-en">str</span> <span class="pl-s"><span class="pl-pds">"</span>detailed request details: <span class="pl-pds">"</span></span> req)
  (<span class="pl-en">info</span> logger (<span class="pl-en">str</span> <span class="pl-s"><span class="pl-pds">"</span>minimal request details: <span class="pl-pds">"</span></span> (<span class="pl-en">select-keys</span> req [<span class="pl-c1">:character-encoding</span>
                                                                  <span class="pl-c1">:content-length</span>
                                                                  <span class="pl-c1">:request-method</span>
                                                                  <span class="pl-c1">:uri</span>]))))

(<span class="pl-en">wrap-with-logger</span> app {<span class="pl-c1">:printer</span> <span class="pl-c1">:my-printer</span>})</pre></div>

<p>A <code>:no-color</code> printer is provided, so to disable color:</p>

<div class="highlight highlight-clojure"><pre>(<span class="pl-en">wrap-with-logger</span> app {<span class="pl-c1">:printer</span> <span class="pl-c1">:no-color</span>})</pre></div>

<h2>
<a id="example-log" class="anchor" href="#example-log" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example Log</h2>

<p>This is an example of logging at TRACE level with log4j:</p>

<p><img src="example/log-capture.png" alt="example log capture"></p>

<p>Check out <a href="example">the example project</a> if you want to generate a similar output in your local machine.</p>

<h2>
<a id="log-the-request-body-for-debugging" class="anchor" href="#log-the-request-body-for-debugging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Log the request body (for debugging)</h2>

<p>If logging the request &amp; response metadata is not enough when debugging and you need to take a look to
each request body, then you can use <code>wrap-with-body-logger</code>:</p>

<div class="highlight highlight-clojure"><pre>(<span class="pl-k">def</span> <span class="pl-e">handler</span> (<span class="pl-en">-&gt;</span> app
                 wrap-with-logger
                 wrap-with-body-logger))</pre></div>

<p><strong>Just be careful</strong>: This is <em>inefficient</em> as it has to consume the body input stream from the request
and then put it again as a new input stream so your handler can also consume it as would normally do.</p>

<h2>
<a id="logging-only-certain-requests" class="anchor" href="#logging-only-certain-requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging only certain requests</h2>

<p>If you wish to restrict logging to certain paths (or other
conditions), combine ring-logger with
<a href="https://github.com/pjlegato/ring.middleware.conditional">ring.middleware.conditional</a>, like so:</p>

<div class="highlight highlight-clojure"><pre>(<span class="pl-c1">:require</span> [ring.middleware.conditional <span class="pl-c1">:as</span> c <span class="pl-c1">:refer</span>  [<span class="pl-k">if-url-starts-with</span>
                                                      <span class="pl-k">if-url-doesnt-start-with</span>
                                                      <span class="pl-k">if-url-matches</span>
                                                      <span class="pl-k">if-url-doesnt-match</span>]])

(<span class="pl-k">def</span> <span class="pl-e">my-ring-app</span>
   (<span class="pl-en">-&gt;</span> handler
       (<span class="pl-k">if-url-starts-with</span> <span class="pl-s"><span class="pl-pds">"</span>/foo<span class="pl-pds">"</span></span> wrap-with-logger)

        <span class="pl-c">;; Or:</span>
        <span class="pl-c">;; (c/if some-test-fn wrap-with-logger)</span>
        <span class="pl-c">;; etc.</span>

       wrap-with-other-handler))</pre></div>

<p>Consult the <a href="https://github.com/pjlegato/ring.middleware.conditional">ring.middleware.conditional docs</a> for full details.</p>

<h2>
<a id="roadmap" class="anchor" href="#roadmap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Roadmap</h2>

<ul>
<li>
<p>0.7.x</p>

<ul>
<li>[x] Remove onelog if we think it doesn't needs to be in ring-logger (I mean: if the same can be done by using onelog in the client app + some customization).</li>
<li>[x] Leave only tools.logging implementation in ring-logger, extract timbre implementation to other library.</li>
<li>[ ] Add the unique request-id as log context in ring-logger. Currently it's only supported by ring-logger-onelog</li>
<li>[x] Use proper maps instead of keyword options.</li>
<li>[ ] Development: Add more tests.</li>
</ul>
</li>
<li>
<p>0.6.x</p>

<ul>
<li>[x] Keep the migration path from ring.middleware.logger as smooth as possible.</li>
<li>[x] Add support for tools.loggging and timbre, with the possibility to not bring not needed dependencies.</li>
<li>[x] Allow for more customizations (color/no-color, customize specific log messages).</li>
<li>[x] Development: Add tests, use continuous integration.</li>
</ul>
</li>
</ul>

<h2>
<a id="similar-projects" class="anchor" href="#similar-projects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Similar projects</h2>

<p><a href="http://github.com/pjlegato/ring.middleware.logger">pjlegato/ring.middleware.logger</a>: ring-logger started as a fork
of ring.middleware.logger. We recommend it as a great option if you don't mind pulling a transitive dependency on onelog &amp; log4j.</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Pull requests are welcome!</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright (C) 2015 Nicolás Berger, 2012-2014 Paul Legato.</p>

<p>Distributed under the Eclipse Public License, the same as Clojure.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Ring-logger maintained by <a href="https://github.com/nberger">nberger</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-67009779-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
